<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Wellington Draft 1 â€” 144 Images</title>
<style>
  :root { --gap: 6px; }
  body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji"; }
  .wrap { padding: 12px; }
  table { border-collapse: separate; border-spacing: var(--gap); width: 100%; table-layout: fixed; }
  tr { counter-increment: row; counter-reset: col; }
  td { background: #f7f7f7; border-radius: 8px; overflow: hidden; position: relative; vertical-align: top; }
  td::before {
    counter-increment: col;
    content: counter(row) "-" counter(col);
    position: absolute; inset: 6px auto auto 6px;
    background: rgba(255,255,255,0.8);
    padding: 2px 6px; border-radius: 6px; font-size: 12px;
  }
  img { display: block; width: 100%; height: auto; }
  @media (prefers-color-scheme: dark) {
    body { background: #0b0b0c; color: #eee; }
    td { background: #151518; }
    td::before { background: rgba(0,0,0,0.45); color: #fff; }
  }
</style>
</head>
<body>
<!--
  This HTML file displays a grid of portal images from a mission series.
  It fetches data from `points.json`, extracts all portal image URLs,
  and arranges them in a responsive 6-column grid.
  The `points.json` file must be in the same directory.

  NOTE: To view this page correctly, you must serve it from a local web server.
  Opening it directly as a file (file:///) will cause a network error due to
  browser security policies. You can use `python3 -m http.server` or `npx serve`
  in your project directory to start a simple server.
-->
<div class="wrap">
  <p id="status"></p>
  <table role="grid"><tbody id="image-grid"></tbody></table>
</div>
<script>
  // This script fetches mission data, extracts portal images, and displays them in a grid.
  async function loadImages() {
    const tbody = document.getElementById('image-grid');
    const status = document.getElementById('status');
    status.textContent = 'Loading images...';

    try {
      // 1. Fetch the mission data from the points.json file.
      const response = await fetch('points.json');
      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }
      const data = await response.json();

      // 2. Validate data and extract all portal image URLs from the mission data.
      if (!data || !Array.isArray(data.missions)) {
        throw new Error('Invalid data structure: "missions" array not found.');
      }
      // It iterates through each mission and then through each portal, collecting the `imageUrl`.
      const images = data.missions.flatMap(m => m.portals.map(p => p.imageUrl)).filter(Boolean);

      if (images.length === 0) {
        status.textContent = 'No images found in points.json.';
        return;
      }
      status.textContent = `Loaded ${images.length} images.`;

      let row;
      // 3. Create the image grid.
      // For each image URL, it creates an `<img>` element and adds it to a table cell.
      // A new table row is created for every 6 images to form the grid.
      images.forEach((url, i) => {
        if (i % 6 === 0) { // Create a new row every 6 images
          row = document.createElement('tr');
          tbody.appendChild(row);
        }
        const cell = document.createElement('td');
        const img = document.createElement('img');
        img.src = url;
        img.loading = 'lazy'; // Lazy loading improves performance by only loading images as they are scrolled into view.
        cell.appendChild(img);
        row.appendChild(cell);
      });
    } catch (error) {
      console.error('Failed to load images:', error);
      status.textContent = `Error: Could not load images. ${error.message}`;
      status.style.color = 'red';
    }
  }
  // Run the function to load and display the images when the page loads.
  loadImages();
</script>
</body>
</html>